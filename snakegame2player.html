<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<title>双人贪吃蛇</title>
<style>
:root {--bg:#0b0b0b; --grid:#111; --snake1:#4ee44e; --snake2:#4ea4ff; --food:#ff4d4d; --ui:#e6e6e6;}
html,body{height:100%;margin:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#051018,#071526);font-family:Inter,system-ui,"Microsoft YaHei";color:var(--ui);}
.wrap{width:min(920px,96vw);display:grid;grid-template-columns:1fr 260px;gap:20px;padding:20px;}
.board{background:var(--bg);border-radius:12px;padding:12px;display:flex;align-items:center;justify-content:center;}
canvas{background:var(--grid);border-radius:8px;display:block;}
h1{margin:0 0 10px 0;font-size:18px;}
.score{font-size:22px;font-weight:bold;}
.kbd{background:#0f1724;border:1px solid #18232e;padding:3px 6px;border-radius:6px;}
button{background:#0f1724;color:var(--ui);border:1px solid #233042;border-radius:6px;padding:6px 10px;cursor:pointer;}
</style>
</head>
<body>
<div class="wrap">
  <div class="board"><canvas id="game" width="600" height="600"></canvas></div>
  <div class="panel">
    <h1>双人贪吃蛇 🐍</h1>
    <div>绿色分数：<span id="score1" class="score">0</span></div>
    <div>蓝色分数：<span id="score2" class="score">0</span></div>
    <p>控制方式：</p>
    <ul style="font-size:14px;line-height:1.5">
      <li>绿色蛇：<span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span></li>
      <li>蓝色蛇：方向键控制</li>
      <li><span class="kbd">空格</span> 暂停/继续</li>
    </ul>
    <div class="row">
      <button id="startBtn">开始</button>
      <button id="pauseBtn">暂停</button>
      <button id="resetBtn">重置</button>
    </div>
  </div>
</div>
<script>
(function(){
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const score1El = document.getElementById("score1");
const score2El = document.getElementById("score2");
let running=false, timer=null, speed=8, cell=20;
const cols=30, rows=30;
let food=null;
let snake1=[], dir1={x:1,y:0}, nextDir1={x:1,y:0};
let snake2=[], dir2={x:-1,y:0}, nextDir2={x:-1,y:0};
let score1=0, score2=0;

function reset(){
  snake1=[]; snake2=[];
  for(let i=0;i<4;i++) snake1.push({x:5-i,y:10});
  for(let i=0;i<4;i++) snake2.push({x:25+i,y:20});
  dir1={x:1,y:0}; nextDir1={x:1,y:0};
  dir2={x:-1,y:0}; nextDir2={x:-1,y:0};
  score1=score2=0;
  score1El.textContent=score1; score2El.textContent=score2;
  placeFood(); draw(); running=false; clearInterval(timer);
}

function placeFood(){
  while(true){
    const fx=Math.floor(Math.random()*cols), fy=Math.floor(Math.random()*rows);
    if(![...snake1,...snake2].some(s=>s.x===fx&&s.y===fy)){ food={x:fx,y:fy}; break; }
  }
}

function drawRoundRect(x,y,w,h,r,color){
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  ctx.fill();
}

function draw(){
  ctx.fillStyle="#06121a"; ctx.fillRect(0,0,canvas.width,canvas.height);
  // 食物
  if(food) drawRoundRect(food.x*cell+2, food.y*cell+2, cell-4, cell-4, 6, "#ff4d4d");
  // 蛇
  snake1.forEach((s,i)=>drawRoundRect(s.x*cell+1,s.y*cell+1,cell-2,cell-2,6,i===0?"#7ef17e":"#4ee44e"));
  snake2.forEach((s,i)=>drawRoundRect(s.x*cell+1,s.y*cell+1,cell-2,cell-2,6,i===0?"#7ec1ff":"#4ea4ff"));
}

function moveSnake(snake, dir, nextDir, scoreEl, color){
  if(!(nextDir.x===-dir.x&&nextDir.y===-dir.y)) dir={...nextDir};
  const head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};
  if(head.x<0||head.x>=cols||head.y<0||head.y>=rows) return "crash";
  for(const s of snake) if(s.x===head.x&&s.y===head.y) return "crash";
  snake.unshift(head);
  if(food&&head.x===food.x&&head.y===food.y){
    if(color==="green") score1El.textContent=++score1;
    else score2El.textContent=++score2;
    placeFood();
  } else snake.pop();
  return dir;
}

function step(){
  const d1=moveSnake(snake1, dir1, nextDir1, score1El, "green");
  if(d1==="crash"){ declareWinner("蓝色蛇胜利！"); return; } else dir1=d1;
  const d2=moveSnake(snake2, dir2, nextDir2, score2El, "blue");
  if(d2==="crash"){ declareWinner("绿色蛇胜利！"); return; } else dir2=d2;
  draw();
}

function declareWinner(msg){
  running=false; clearInterval(timer);
  ctx.fillStyle="rgba(0,0,0,0.4)"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff"; ctx.font="22px sans-serif"; ctx.textAlign="center";
  ctx.fillText(msg, canvas.width/2, canvas.height/2);
}

function start(){ if(running) return; running=true; clearInterval(timer); timer=setInterval(step,1000/speed);}
function togglePause(){ if(!running){start();}else{running=false; clearInterval(timer);}}

window.addEventListener("keydown", function(e){
  const k=e.key;
  if(k==='w'||k==='W') nextDir1={x:0,y:-1};
  else if(k==='s'||k==='S') nextDir1={x:0,y:1};
  else if(k==='a'||k==='A') nextDir1={x:-1,y:0};
  else if(k==='d'||k==='D') nextDir1={x:1,y:0};
  else if(k==='ArrowUp') nextDir2={x:0,y:-1};
  else if(k==='ArrowDown') nextDir2={x:0,y:1};
  else if(k==='ArrowLeft') nextDir2={x:-1,y:0};
  else if(k==='ArrowRight') nextDir2={x:1,y:0};
  else if(k===' ') togglePause();
  // 隐藏功能：直接胜利
  else if(k==='/'||e.code==='Slash') declareWinner("蓝色蛇胜利！");
  else if(k==='Alt') declareWinner("绿色蛇胜利！");
});

document.getElementById("startBtn").addEventListener("click",start);
document.getElementById("pauseBtn").addEventListener("click",togglePause);
document.getElementById("resetBtn").addEventListener("click",reset);

reset();
})();
</script>
</body>
</html>
